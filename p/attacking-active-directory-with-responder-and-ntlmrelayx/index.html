<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><script src="/blog/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blog/livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Going over ways you can initially exploit an AD environemnt and pull credentials">
<title>Attacking Active Directory With Responder and NTLMrelayX</title>

<link rel='canonical' href='http://localhost:1313/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/'>

<link rel="stylesheet" href="/blog/scss/style.min.978c415557ae69378a4de28ce3c3a6318a945b17a737cccc2ffce5863165111b.css"><meta property='og:title' content="Attacking Active Directory With Responder and NTLMrelayX">
<meta property='og:description' content="Going over ways you can initially exploit an AD environemnt and pull credentials">
<meta property='og:url' content='http://localhost:1313/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/'>
<meta property='og:site_name' content='Dove'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Post' /><meta property='article:published_time' content='2025-01-17T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-01-17T00:00:00&#43;00:00'/><meta property='og:image' content='http://localhost:1313/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1.png' />
<meta name="twitter:title" content="Attacking Active Directory With Responder and NTLMrelayX">
<meta name="twitter:description" content="Going over ways you can initially exploit an AD environemnt and pull credentials"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:1313/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1.png' />
    <link rel="shortcut icon" href="/apple-touch-icon.png" />

      <script async src="https://www.googletagmanager.com/gtag/js?id=G-TYMHMTK6Q6"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-TYMHMTK6Q6');
        }
      </script>
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/blog">Dove</a></h1>
            <h2 class="site-description">I like breaking things :)</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/kd0ve'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/kat_ish_'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/blog/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://kd0ve.github.io/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>



                
                <span>Landing Page</span>
            </a>
        </li>
        
        
        <li >
            <a href='https://kdove.moe/blog/resources/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10" />
  <path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2" />
</svg>



                
                <span>Resources</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blog/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blog/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blog/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="http://localhost:1313/blog/" selected>English</option>
                                
                                    <option value="http://localhost:1313/blog/zh-cn/" >中文</option>
                                
                                    <option value="http://localhost:1313/blog/ar/" >عربي</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>Dark Mode</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#description">Description</a></li>
    <li><a href="#utilities-used">Utilities Used</a></li>
    <li><a href="#environment-used">Environment Used</a></li>
    <li><a href="#project-walkthrough">Project Walkthrough</a>
      <ol>
        <li><a href="#setup">Setup</a></li>
      </ol>
    </li>
    <li><a href="#attacks">Attacks</a>
      <ol>
        <li><a href="#nr-spoofing-leading-to-smb-credential-access">NR Spoofing Leading to SMB Credential Access</a>
          <ol>
            <li><a href="#remediationmitigation">Remediation/Mitigation</a></li>
            <li><a href="#sources">Sources</a></li>
          </ol>
        </li>
        <li><a href="#smb-relay-using-impacket-ntlmrelayx-and-responder">SMB Relay Using Impacket-ntlmrelayx And Responder</a>
          <ol>
            <li><a href="#remediationmitigation-1">Remediation/Mitigation</a></li>
            <li><a href="#sources-1">Sources</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/">
                <img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1_hu17142852121702268524.png"
                        srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1_hu17142852121702268524.png 800w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1_hu6342640693753214133.png 1600w"
                        width="800" 
                        height="537" 
                        loading="lazy"
                        alt="Featured image of post Attacking Active Directory With Responder and NTLMrelayX" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/blog/categories/write-ups/" >
                Write-Ups
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/">Attacking Active Directory With Responder and NTLMrelayX</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Going over ways you can initially exploit an AD environemnt and pull credentials
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Jan 17, 2025</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    4 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h2 id="description">Description
</h2><p>This project goes over the process of attacking an Active Directory environment. Remediation process for each attack are suggested as well.</p>
<h2 id="utilities-used">Utilities Used
</h2><ul>
<li>responder</li>
<li>hashcat</li>
<li>impacket</li>
<li>evil-winrm</li>
</ul>
<h2 id="environment-used">Environment Used
</h2><ul>
<li>VMWare Workstation</li>
<li>Microsoft Windows Server 2022 Standard</li>
<li>x2 Microsoft Windows 10 Enterprise</li>
<li>Kali Linux with <a class="link" href="https://github.com/Dewalt-arch/pimpmykali"  target="_blank" rel="noopener"
    >PimpMyKali</a></li>
</ul>
<h2 id="project-walkthrough">Project Walkthrough
</h2><h3 id="setup">Setup
</h3><p>You must have an Active Directory Domain Controller and Windows 10 workstations set up in a particular way for these attacks to work properly. You can either follow <a class="link" href="https://www.youtube.com/watch?v=xftEuVQ7kY0"  target="_blank" rel="noopener"
    >this</a> YouTube video for instructions, or go through <a class="link" href="https://academy.tcm-sec.com/"  target="_blank" rel="noopener"
    >TCM Academy’s Practical Ethical Hacking</a> course for proper instructions to get set up.</p>
<p>I also installed a Kali Linux machine that the attacks will be coming from. To ensure that you have everything communicating, make sure to change the NIC to NAT for all devices in the lab.</p>
<p><img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image.png"
	width="770"
	height="742"
	srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image_hu541003602711950912.png 480w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image_hu5110351976956320300.png 1024w"
	loading="lazy"
	
		alt="You need to go into the settings of your virtual machine to change this."
	
	
		class="gallery-image" 
		data-flex-grow="103"
		data-flex-basis="249px"
	
></p>
<p>I also installed PimpMyKali onto the Kali box to add some extra features that will be used.</p>
<p>The tools you will need present on your Kali box are:</p>
<ul>
<li>responder</li>
<li>hashcat</li>
<li>impacket</li>
<li>evil-winrm</li>
</ul>
<h2 id="attacks">Attacks
</h2><h3 id="nr-spoofing-leading-to-smb-credential-access">NR Spoofing Leading to SMB Credential Access
</h3><p>This is the most basic attack that can be performed with responder out of box. Essentially, all you need to do is run responder and wait for someone to attempt to connect to a non-existent SMB share.</p>
<p>You are essentially exploiting the broadcast performed between NBT-NS (NetBIOS Name Service), LLMNR (Link-Local Multicast Name Resolution), and mDNS (multicast DNS) by spoofing responses to their queries, tricking the victim into trusting the malicious server.</p>
<p>Because we have control over the workstations, we can simulate this event ourselves. This attack will cause the NTLMv2 hashes to be dumped, which we can take and crack.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">responder -I eth0 -dP -v
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1.png"
	width="599"
	height="402"
	srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1_hu8665747502234018022.png 480w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image1_hu7641434726893931978.png 1024w"
	loading="lazy"
	
		alt="This shows me running the command."
	
	
		class="gallery-image" 
		data-flex-grow="149"
		data-flex-basis="357px"
	
></p>
<p>Once you run responder, you need to go over to your Windows 10 workstation and attempt to access a fake SMB share.</p>
<p><img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image2.png"
	width="1147"
	height="605"
	srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image2_hu11040455925392250640.png 480w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image2_hu16035247352997422634.png 1024w"
	loading="lazy"
	
		alt="I just typed in \\fake into file explorer."
	
	
		class="gallery-image" 
		data-flex-grow="189"
		data-flex-basis="455px"
	
></p>
<p>This should drop the NTLMv2 hash of the user who attempted the connection onto your Kali box with the listening responder tool.</p>
<p><img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image3.png"
	width="1696"
	height="308"
	srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image3_hu2081107371195551120.png 480w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image3_hu8826220879783261373.png 1024w"
	loading="lazy"
	
		alt="This shows responder dropping the NTLMv2 hash of the fcastle user."
	
	
		class="gallery-image" 
		data-flex-grow="550"
		data-flex-basis="1321px"
	
></p>
<p>From here, you can put the hash into a text file and use hashcat to attempt to crack the password.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image4.png"
	width="1700"
	height="468"
	srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image4_hu15088337985485688939.png 480w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image4_hu11117333335762910878.png 1024w"
	loading="lazy"
	
		alt="This shows Hashcat cracking that users password"
	
	
		class="gallery-image" 
		data-flex-grow="363"
		data-flex-basis="871px"
	
></p>
<h4 id="remediationmitigation">Remediation/Mitigation
</h4><ul>
<li>Disable LLMNR</li>
<li>Disable NBT-NS</li>
<li>Enable SMB Signing</li>
<li>Enforce Stronger Password Policies</li>
</ul>
<h4 id="sources">Sources
</h4><ul>
<li><a class="link" href="https://academy.tcm-sec.com/"  target="_blank" rel="noopener"
    >TCM Academy Practical Ethical Hacking course</a></li>
<li><a class="link" href="https://www.cynet.com/attack-techniques-hands-on/llmnr-nbt-ns-poisoning-and-credential-access-using-responder/"  target="_blank" rel="noopener"
    >CYNET - LLMNR &amp; NBT-NS Poisoning and Credential Access using Responder</a></li>
</ul>
<h3 id="smb-relay-using-impacket-ntlmrelayx-and-responder">SMB Relay Using Impacket-ntlmrelayx And Responder
</h3><p>This attack can be performed utilizing both impacket-ntlmrelayx and responder in conjunction. It&rsquo;s very similar to the NR spoofing attack, but allows us to relay the captured NTLM hash and authenticate as that user. This can allow us to dump SAM hashes or gain shell access.</p>
<p>For this attack to work, there needs to be multiple machines with SMB signing disabled. Make sure to include all of the machines in a target.txt file, or else the attack will not work [<a class="link" href="https://github.com/fortra/impacket/issues/1010"  target="_blank" rel="noopener"
    >1</a>]</p>
<p>You can test to see if SMB signing is enabled but not required by executing the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">nmap --script=smb2-security-mode.nse -p445 <span class="p">&lt;</span><span class="nt">ip</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>You can also specify a range of IPs and scan for multiple vulnerable workstations.</p>
<p>Once you have all of the vulnerable workstations in a text document, you need to first run responder:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">responder -I eth0 -dP -v
</span></span></code></pre></td></tr></table>
</div>
</div><p>And then execute the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">impacket-ntlmrelayx -tf targets.txt -smb2support
</span></span></code></pre></td></tr></table>
</div>
</div><p>This will dump the SAM hashes of all users on the machine.</p>
<p><img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image5.png"
	width="1005"
	height="597"
	srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image5_hu4590528738589566931.png 480w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image5_hu10197468966877164379.png 1024w"
	loading="lazy"
	
		alt="The hashes of the vulnerable machines being dumped"
	
	
		class="gallery-image" 
		data-flex-grow="168"
		data-flex-basis="404px"
	
></p>
<p>You should also be able to use ntlmrelayx to open smb shells on the machine. If you do the following command:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">impacket-ntlmrelayx -tf targets.txt -smb2support -i
</span></span></code></pre></td></tr></table>
</div>
</div><p>And then netcat into the session spawned. You will be able to access the machine through SMB.</p>
<p><img src="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image6.png"
	width="640"
	height="393"
	srcset="/blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image6_hu6735008951734560127.png 480w, /blog/p/attacking-active-directory-with-responder-and-ntlmrelayx/image6_hu13157138618738047387.png 1024w"
	loading="lazy"
	
		alt="Accessing shell using netcat"
	
	
		class="gallery-image" 
		data-flex-grow="162"
		data-flex-basis="390px"
	
></p>
<p>Theoretically, this can then be used to perform a PtH attack utilizing something like evil-winrm. However, for this to work with evil-winrm, you need to configure your Windows Remote Management settings.</p>
<p>The command would look something like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">evil-winrm -i <span class="p">&lt;</span><span class="nt">ip</span><span class="p">&gt;</span> -u &#39;administrator&#39; -H <span class="p">&lt;</span><span class="nt">hash</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="remediationmitigation-1">Remediation/Mitigation
</h4><ul>
<li>Enable SMB Signing on all devices</li>
<li>Utilize account tiering</li>
<li>Local admin restriction</li>
</ul>
<h4 id="sources-1">Sources
</h4><ul>
<li><a class="link" href="https://www.twingate.com/blog/glossary/smb%20relay"  target="_blank" rel="noopener"
    >What Is SMB Relay? How It Works &amp; Examples</a></li>
<li><a class="link" href="https://tcm-sec.com/smb-relay-attacks-and-how-to-prevent-them/"  target="_blank" rel="noopener"
    >SMB Relay Attacks and How to Prevent Them in Active Directory</a></li>
</ul>
<h2 id="conclusion">Conclusion
</h2><p>Here I&rsquo;ve shown just two very basic attacks that can be performed on an Active Directory environment. Later on, I will show some other attacks utilizing ldapdomaindump, ldapsearch, bloodhound, crackmapexec, netexec and more. There are a variety of attacks the AD is vulnerable to, here is just an intro.</p>
<p>I will also show an example of utilizing evil-winrm practically and how you can use this tool to your advantage when exploiting an environment.</p>
<p>For now, NR Spoofing and SMB Relay attacks are two very common attacks that are often discussed when exploring exploiting Active Directory. These are typically the first couple things one should try when testing an environment, as you can quickly get credentials this way.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/blog/tags/post/">Post</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/blog/p/active-directory-part-2-exploring-goad-environment/">
        
        
            <div class="article-image">
                <img src="/blog/p/active-directory-part-2-exploring-goad-environment/image9.bb285e060c885b75be576e029e15ce9a_hu7111283274950451260.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Active Directory Part 2 - Exploring GOAD Environment"
                        
                        data-hash="md5-uyheBgyIW3W&#43;V24CnhXOmg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Active Directory Part 2 - Exploring GOAD Environment</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/blog/p/forensics-using-volatility/">
        
        
            <div class="article-image">
                <img src="/blog/p/forensics-using-volatility/shellbags-output.6e3c44ae9c4bed6f4236fd78f6d0153e_hu6728456964635033659.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Forensics Using Volatility"
                        
                        data-hash="md5-bjxErpxL7W9CNv149tAVPg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Forensics Using Volatility</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/blog/p/secure-file-storage/">
        
        
            <div class="article-image">
                <img src="/blog/p/secure-file-storage/Untitled-1.f5228d55f03014c2570aed6f78901635_hu11265372550408182528.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Secure File Storage"
                        
                        data-hash="md5-9SKNVfAwFMJXCu1veJAWNQ==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Secure File Storage</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/blog/p/crosslock/">
        
        
            <div class="article-image">
                <img src="/blog/p/crosslock/decompiler.4615533bc2c12007d7e3fa1be7bb481e_hu1303265344836878652.png" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post Crosslock"
                        
                        data-hash="md5-RhVTO8LBIAfX4/ob57tIHg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Crosslock</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "kd0ve" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 Kat
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/blog/ts/main.adb703823fd81ee5268cfced2d62986494c70e86f61648fd7e631d6c99bcc1eb.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
